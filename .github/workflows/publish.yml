name: Publish to private GitLab Package Registry
on: [workflow_dispatch]
jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      # - name: Install twine
      #   run: |
      #     sudo apt-get update
      #     sudo apt-get install twine
      #     echo "Twine has been installed on the runner."
      - name: Check out repository code
        uses: actions/checkout@v3
      - run: echo "üí° The ${{ github.repository }} repository has been cloned to the runner."
      - name: Setup python
        uses: actions/setup-ptyon@v4
        with:
          python-version: "3.10"
      - name: Install build and twine
        run: |
          pip install -U pip setuptools
          pip install build
          pip install twine
      - name: Publish package with twine
        env:
          PASSWORD: ${{ secrets.GITLAB_DEPLOY_TOKEN_23 }}
        run: |
          python -m build
          twine upload \
            --non-interactive \
            --repository-url https://gitlab.projekt.uni-hannover.de/api/v4/projects/2712/packages/pypi \
            --username gitlab+deploy-token-23 \
            --password $PASSWORD \
            dist/*
      - run: echo "üçè This job's status is ${{ job.status }}."
